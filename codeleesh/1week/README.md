## 도베인 주도 개발 시작하기 : DDD 핵심 개념 정리부터 구현까지

- 정리 범위
  - Chapter 1 도메인 모델 시작하기 : 1.1 ~ 1.5

## 1.1 도메인이란?

- 구현해야 할 소프트웨어 대상
- 소프트웨어로 해결하고자 하는 문제 영역
- 도메인은 여러 도메인으로 나눌 수 있다.

  ```
  온라인 서점은 주문, 혜택, 회원, 정산, 결제, 배송, 카탈로그, 리뷰 등의 하위 도메인들이 존재한다.

  거래소는 주문, 혜택, 회원, 거래, 자산, 지갑, 알림 등 하위 도메인이 존재한다.
  ```

- 소프트웨어가 도메인의 모든 기능을 제공하진 않는다.

  ```
  온라인 서점의 경우 배송 시스템 및 결제 대행업체를 이용할 수 있다.

  거래소의 경우 휴대폰 본인인증, 신분증 진위확인, 계좌점유 등 대행 업체를 이용할 수 있다.
  ```

## 1.2 도메인 전문가와 개발자 간 지식 공유

- 도메인 전문가
  - 도메인의 해당 지식과 경험을 바탕으로 원하는 기능 개발 요구
- 개발자
  - 요구사항을 분석하고 설계하여 코드를 작성하며 테스트 및 배포

개발자는 요구사항을 올바르게 이해하는 것이 중요하다.
그렇다면, 요구사항을 올바르게 이해하려면 어떻게 해야 할까?

- 개발자와 전문가가 직접 대화하는 것이다.
- 도메인 전문가 만큼은 아니겠지만 이해관계자와 개발자도 도메인 지식을 갖춰야 한다.
- 도메인 전문가, 관계자, 개발자가 같은 지식을 공유하고 직접 소통할수록 도메인 전문가가 원하는 제품을 만들 가능성이 높아진다.

### Garbage in, Garbage out

- 개발자가 도메인 전문가와 직접 소통할수록 요구사항이 변질될 가능성이 줄지만 도메인 전문가라고 해서 항상 올바른 요구사항을 주는 것은 아니다.
- 전문가나 관련자가 요구한 내용이 항상 올바른 것은 아니며 때론 본인들이 실제로 원하는 것을 정확하게 표현하지 못할 수 있다.
- 개발자는 요구사항을 이해할 떄 왜 이런 기능을 요구하는지 또는 실제로 원하는 게 무엇인지 생각하고 전문가와 대화를 통해 진짜로 원하는 것을 찾아야 한다.

## 1.3 도메인 모델

도메인 모델을 사용하면 여러 관계자들이 동일한 모습으로 도메인을 이해하고 도메인 지식을 공유하는 데 도움이 된다.

### 목적

- 도메인 모델의 목적은 기본적으로 도메인 자체를 이해하기 위한 개념 모델이다.

### 방안

도메인을 이해하기 위한 방안으로는,

- 도메인이 제공하는 기능 파악
- 도메인의 주요 데이터 구성을 파악

기능과 데이터를 함께 보여주는 겍체 모델은 도메인을 모델링하기에 적합하다.

### 종류

도메인 모델의 종류로는, 

- 클래스 다이어그램
- 상태 다이어그램
- 그래프 

중요한 것은 도메인을 이해하는 데 도움이 된다면 표현 방식이 중요하지는 않다.

### 하위 도메인과 모델

- 각 하위 도메인이 다루는 영역은 서로 다르기 때문에 같은 용어라도 하위 도메인마다 의미가 달라질 수 있다.
- 모델의 각 구성요소는 특정 도메인으로 한정할 때 비로소 의미가 완전해지기 때문에 각 하위 도메인마다 별도로 모델을 만들어야 한다.

## 1.4 도메인 모델 패턴

일반적인 어플리케이션 아키텍쳐는 다음과 같이 4개의 계층으로 구성된다.

- 사용자 →
- 사용자 인터페이스 or 표현
- 응용
- 도메인
- 인프라스트럭처
- 데이터베이스 ←

### 도메인 모델 패턴 

엔터프라이즈 애플리케이션 아키텍처 패턴 (PEAA), 마틴 파울러

- 아키텍처 상의 도메인 계층을 객체 지향 기법으로 구현하는 패턴
- 도메인 계층의 객체 모델 : 도메인 모델

도메인과 관련된 중요 업무 규칙은 도메인 모델에서 구현한다.

- 도메인 모델에만 위치하기 때문에 규칙이 바뀌거나 규칙을 확장할 때 다른 코드에 영향을 덜 주고 변경 내역을 모델에 반영할 수 있게 된다.

### 개념모델과 구현모델

- 개념모델
  - 순수하게 문제를 분석한 결과물
  - 데이터베이스, 트랜잭션 처리, 성능, 구현 기술 고려하지 않는다.
  - 처음부터 완벽한 게념모델을 만들기보다는 전반적인 개요를 알 수 있는 수준으로 작성해야 한다.
- 구현모델
  - 개념모델을 기반으로 점진적으로 발전시킨다.

## 1.5 도메인 모델 도출

도메인 모델링할 때 기본이 되는 작업은 핵심 구성요소, 규칙, 기능을 찾는 것이다.

### 주문 도메인과 관련한 몇 가지 요구사항

```text
- 최소 한 종류 이상의 상품을 주문해야 한다.
- 한 상품을 한 개 이상 주문할 수 있다.
- 총 주문 금액은 각 상품의 구매 가격 합을 모두 더한 금액이다.
- 각 상품의 구매 가격 합은 상품 가격에 구매 개수를 곱한 값이다.
- 주문할 때 배송지 정보를 반드시 지정해야 한다.
- 배송지 정보 받는 사람 이름, 전화번호, 주소로 구성된다.
- 출고를 하면 배송지를 변경할 수 없다.
- 출고 전에 주문을 취소할 수 있다.
- 고객이 결제를 완료하기 전에는 상품을 준비하지 않는다.
```

요구사항을 통해 알 수 있는 것

```text
- 출고 상태로 변경하기
- 배송지 정보 변경하기
- 주문 취소하기
- 결제 완료하기
```

요구사항를 통해서 도메인을 구성하는 항목과 관계에 대해서 유추해볼 수 있다.

### 도메인의 주요 데이터 구성을 파악

다음 항목을 통해서 주문 항목이 어떤 데이터로 구성되는지 알 수 있다.

```text
- 한 상품을 한 개 이상 주문할 수 있다.
- 각 상품의 구매 가격 합은 상품 가격에 구매 개수를 곱한 값이다.
```

- `OrderLine`은 적어도 주문할 상품, 상품의 가격, 구매 개수를 포함한다.
- 구매 항목의 대한 가격도 제공 필요하다.

다음 항목을 통해서 주문과 주문 항목의 관계을 알 수 있다.

```text
- 최소 한 종류 이상의 상품을 주문해야 한다.
- 총 주문 금액은 각 상품의 구매 가격 합을 모두 더한 금액이다.
```

- `Order`는 최소 한 개 이상의 `OrderLine` 을 포함해야 한다.
- 총 주문 금액은 `OrderLine`에서 구할 수 있다.

다음 항목을 배송지 정보에 대해서 알 수 있다.

```text
- 배송지 정보 받는 사람 이름, 전화번호, 주소로 구성된다.
- 주문할 때 배송지 정보를 반드시 지정해야 한다.
```

- `ShippingInfo` 는 사람 이름, 전화번호, 주소를 포함한다.
- `ShippingInfo` 는 `Order` 를 생성할 때 필요하다.

다음 요구사항을 통해서 도메인이 제공하는 기능에 대해서 알아볼 수 있다.

### 도메인이 제공하는 기능 파악

다음 항목을 통해서 요구사항에서 제약과 규칙을 알 수 있다.

```text
- 출고를 하면 배송지를 변경할 수 없다.
- 출고 전에 주문을 취소할 수 있다.
```

- 주문은 출고 상태가 필요하다.
- 출고 상태의 따라 배송지 정보 변경 기능과 주문 취소 기능의 제약을 갖는다.

```text
- 고객이 결제를 완료하기 전에는 상품을 준비하지 않는다.
```

- 결재 완료 전을 의미하는 상태와 결제 완료 내지 상품 준비 중이라는 상태가 필요하다.

### 문서화

문서화를 하는 주된 이유는 지식을 공유하기 위함이다.

- 전반적인 기능 목록이나 모듈 구조, 빌드 과정은 코드보다는 상위 수준에서 정리한 문서를 참조하는 것이 이해도를 높인다.
- 코드를 보면서 도메인을 깊게 이해하게 되므로 코드 자체도 문서화의 대상이 된다.
- 도메인 지식이 잘 묻어나도록 코드를 작성하지 않으면 코드의 동작 과정은 해석할 수 있어도 도메인 관점에서 왜 코드를 그렇게 작성했는지 이해하는 데는 도움이 되지 않는다.

## 정리

- 도메인은 소프트웨어로 해결하고자 하는 문제 영역이다.
- 개발자는 요구사항을 올바르게 이해하기 위해서 도메인 전문가 및 관계자들과 소통이 필요하다.
- 도메인을 이해하기 위해서 도메인이 제공하는 기능과 도메인의 주요 데이터 구성을 파악해야 하는데, 이를 파악하기 위해서 좋은 방법은 도메인 모델링해야 한다.
  - 도메인 모델에는 클래스 다이어그램, 상태 다이어그램, 그래프 등등 있지만, 도구가 중요한 것은 아니다.
- 도메인 모델의 핵심 규칙을 구현한 코드는 도메인 모델에만 위치하기 때문에 규칙이 바뀌거나 규칙을 확장해야 할 때 다른 코드에 영향을 덜 주고 변경 내역을 모델에 반영할 수 있게 된다.
- 도메인 모델링할 때 기본이 되는 작업은 핵심 구성요소, 규칙, 기능을 찾는 것이다.